pico-8 cartridge // http://www.pico-8.com
version 16
__lua__

left,right,up,down,fire1,fire2=0,1,2,3,4,5
black,dark_blue,dark_purple,dark_green,brown,dark_gray,light_gray,white,red,orange,yellow,green,blue,indigo,pink,peach=0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15

local ps = {}

function _init()
  local gravity = vec2(0, 0.1)

  for i=1,10 do
    local p = particle(10 + rnd(107), 10 + rnd(10))
    p.prevpos += frompolar(rnd(), rnd())

    add(p.fx, function() return gravity end)
    add(ps, p)
  end
end

function _update()
  for p in all(ps) do
    p.update()

    if p.currpos.x < 10 then
      p.prevpos.x = p.currpos.x
      p.currpos.x = 10
    end

    if p.currpos.x > 117 then
      p.prevpos.x = p.currpos.x
      p.currpos.x = 117
    end

    if p.currpos.y > 117 then
      p.prevpos.y = p.currpos.y
      p.currpos.y = 117
    end
  end
end

function _draw()
  cls(light_gray)
  print(time(), 1, 1, dark_gray)

  circ(64, 64, 8, green)
  circ(64, 58, 1, dark_gray)

  for p in all(ps) do
    p.draw()
  end

  -- if (flr(time()) % 2 == 0) then
  --   limb(62, 60, 0.70, 0.05, red)
  --   limb(66, 60, 0.80, 0.15, dark_blue)
  -- else
  --   limb(65, 60, 0.80, 0.15, red)
  --   limb(63, 60, 0.70, 0.05, dark_blue)
  -- end
end

local __vec2 = {}

function __vec2.__add(a, b)
  return vec2(a.x + b.x, a.y + b.y)
end

function __vec2.__sub(a, b)
  return vec2(a.x - b.x, a.y - b.y)
end

function vec2(x, y)
  local v = {
    x = x,
    y = y,
  }

  setmetatable(v, __vec2)

  return v
end

function frompolar(angle, radius)
  return vec2(radius * cos(angle), radius * sin(angle))
end

function particle(x, y)
  local p = {
    currpos = vec2(x, y),
    prevpos = vec2(x, y),
    fx = {}
  }

  function p.update()
    local prevvel = p.currpos - p.prevpos
    local currvel = prevvel

    for f in all(p.fx) do
      currvel += f(p)
    end

    p.prevpos = p.currpos
    p.currpos += currvel
  end

  function p.draw()
    circ(p.currpos.x, p.currpos.y, 1, dark_gray)
    -- circ(p.currpos.x, p.currpos.y, 8, dark_gray)
  end

  return p
end

-- function limb(x, y, angle, bend, color)
--   pole(x, y, angle, 4, color)
--   pole(x + 4 * cos(angle), y + 4 * sin(angle), angle + bend, 4, color)
-- end

-- function pole(x, y, angle, length, color)
--   local x2 = x + length * cos(angle)
--   local y2 = y + length * sin(angle)

--   line(x, y, x2, y2, color)
-- end

__gfx__
00000000000070000000000000007000000000000000700000000000000070000000700000007000000000000000000000000000000000000000000000000000
00000000000605000000700000060500000070000006050000007000000605000006050000060500000000000000000000000000000000000000000000000000
00700700000060000006050000006000000605000000600000060500000060000000600077006050000000000000000000000000000000000000000000000000
00077000000000000000600000000000000060000000000000006000000000000000005060700505000000000000000000000000000000000000000000000000
00077000007050000070000000076000000700000007500000070000007665000777650560065005000000000000000000000000000000000000000000000000
00700700070065000700500000576000005600000076500000760000070660507000600500060005000000000000000000000000000000000000000000000000
00000000060665007006050005067700050600700706650007060050700660056006000500060050000000000000000000000000000000000000000000000000
00000000700660506006050000506070005067000070605000705500600655056006055000070550000000000000000000000000000000000000000000000000
00000000600660500706005000050000000700000007000000060000600600550006705000007050000000000000000000000000000000000000000000000000
00000000607050050600600500007000000570000000700000057000070605000000070000006500000000000000000000000000000000000000000000000000
00000000006050000007050000006500000750000000570000056000000650000000057000006000000000000000000000000000000000000000000000000000
00000000006050000006050000006000000605000000700000050700000600000000050700000700000000000000000000000000000000000000000000000000
00000000070050000006005000056000077005000007500005500600007000000000000600000600000000000000000000000000000000000000000000000000
00000000060050000070005000506000700000500070500050000070006000000000000000000070000000000000000000000000000000000000000000000000
00000000060050000700050000506000000000500060500000000060006000000000000000000060000000000000000000000000000000000000000000000000
00000000700050007000050000006700000000050000550000000007000700000000000000000000000000000000000000000000000000000000000000000000
